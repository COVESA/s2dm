{{- $pages := where .Site.RegularPages "Kind" "page" -}}
{{- $searchExclKinds := .Site.Params.doks.searchExclKinds | default slice -}}
{{- $searchExclTypes := .Site.Params.doks.searchExclTypes | default slice -}}
{{- $showSearch := .Site.Params.doks.showSearch | default slice -}}
{{- $indexSummary := .Site.Params.doks.indexSummary | default false -}}

{{- if gt (len $showSearch) 0 -}}
  {{- $pages = where $pages "Section" "in" $showSearch -}}
{{- end -}}

{{- if gt (len $searchExclKinds) 0 -}}
  {{- $pages = where $pages "Kind" "not in" $searchExclKinds -}}
{{- end -}}

{{- if gt (len $searchExclTypes) 0 -}}
  {{- $pages = where $pages "Type" "not in" $searchExclTypes -}}
{{- end -}}

[
{{- range $index, $page := $pages -}}
  {{- if gt $index 0 }},{{ end }}
  {
    "id": {{ $index }},
    "title": {{ $page.Title | jsonify }},
    "permalink": {{ $page.RelPermalink | jsonify }},
    "summary": {{ if $indexSummary }}{{ $page.Summary | plainify | jsonify }}{{ else }}{{ $page.Summary | plainify | jsonify }}{{ end }},
    "content": {{ if $indexSummary }}{{ $page.Summary | plainify | jsonify }}{{ else }}{{ $page.Content | plainify | jsonify }}{{ end }},
    "date": {{ $page.Date.Format "2006-01-02" | jsonify }},
    "tags": {{ $page.Params.tags | jsonify }}
  }
{{- end -}}
]
